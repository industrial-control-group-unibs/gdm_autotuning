clear all;close all;clc;
Motor = OpenDriveConnection(38400,'3'); 

Jm( idx,1)=get(Motor.Modbus,'ParFloat',12012,0);
Fc(idx,1)=get(Motor.Modbus,'ParFloat',12014,0);
Bm(idx,1)=get(Motor.Modbus,'ParFloat',12016,0);
Kp(idx,1)=get(Motor.Modbus,'ParFloat',12018,0);
Ti(idx,1)=get(Motor.Modbus,'ParFloat',12020,0);
Wc(idx,1)=get(Motor.Modbus,'ParFloat',12022,0);
J=0.0015409;
h=0.00826593;

s=tf('s');

P=1/(J*s+h);

Kp=0.0109491;
Ti=0.385238;

C=Kp*(1+1/Ti/s);

margin(C*P)